---
title: "Insertion / virus content disparity"
author: "bhaas"
date: '2023-03-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r}

rna_insertions_data = read.table("all_insertions_and_virus_content_merged.tsv", header=T, sep="\t", stringsAsFactors = F) %>%
  filter(seqtype == "RNA")

nrow(rna_insertions_data)
```


```{r}
num_insertions_with_matching_virus_content = rna_insertions_data %>% filter %>% select(sample_name, virus, virus_brkend_grp) %>% unique() %>% nrow()
message("num insertions with matching virus content: ", num_insertions_with_matching_virus_content)

num_insertions_without_matching_virus_content =rna_insertions_data %>% filter(is.na(mapped) ) %>% select(sample_name, virus, virus_brkend_grp) %>% unique() %>% nrow()
message("num insertions without matching virus content: ", num_insertions_without_matching_virus_content)

```



# Insertions with no matching virus content

```{r}

insertions_no_matching_virus_content = rna_insertions_data %>% filter(is.na(mapped)) %>% arrange(desc(total_rpm))

insertions_no_matching_virus_content
```


```{r}

write.table(insertions_no_matching_virus_content, file="rna_insertions_without_matching_virus_content.tsv", sep="\t", quote=F, row.names=F)

```



# Examine min read support vs. total insertions and fraction w/o matching virus

```{r}

insertion_without_matching_virus_counts = NULL

for (min_read_count in c(1,2,3,4,5,6,7,8,9,10) ) {
  
  merged_data_min = rna_insertions_data %>% filter(total >= min_read_count)
  num_insertions = nrow(merged_data_min)
  
  num_without_matching_virus = nrow(merged_data_min %>% filter(! matching_virus_content) )
  
  insertion_without_matching_virus_counts = bind_rows(insertion_without_matching_virus_counts, 
                                                      data.frame(min_read_count = min_read_count,
                                                                 num_insertions = num_insertions, 
                                                                 num_without_matching_virus = num_without_matching_virus))
  
}


insertion_without_matching_virus_counts = insertion_without_matching_virus_counts %>% mutate(frac_without_matching_virus = num_without_matching_virus/num_insertions)

insertion_without_matching_virus_counts

```


```{r}


insertion_without_matching_virus_counts %>% ggplot(aes(x=min_read_count, y=frac_without_matching_virus)) + geom_col()

```
```{r}

insertion_without_matching_virus_counts %>% ggplot(aes(x=min_read_count, y=num_insertions)) + geom_col()



```




